<Window x:Class="LogViewer2026.UI.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:LogViewer2026.UI"
        xmlns:avalon="http://icsharpcode.net/sharpdevelop/avalonedit"
        mc:Ignorable="d"
        Title="LogViewer2026 - High-Performance Serilog Log Viewer" 
        Height="800" Width="1400"
        WindowStartupLocation="CenterScreen">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="200"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Menu Bar -->
        <Menu Grid.Row="0">
            <MenuItem Header="_File">
                <MenuItem Header="_Open Log File..." Command="{Binding OpenFileCommand}"/>
                <MenuItem Header="Open _Multiple Files..." Command="{Binding OpenMultipleFilesCommand}"/>
                <MenuItem Header="Open _Folder..." Command="{Binding OpenFolderCommand}"/>
                <Separator/>
                <MenuItem Header="_Settings..." Click="Settings_Click"/>
                <Separator/>
                <MenuItem Header="E_xit" Click="Exit_Click"/>
            </MenuItem>
            <MenuItem Header="_Edit">
                <MenuItem Header="_Copy" Command="{Binding CopyToClipboardCommand}"/>
            </MenuItem>
            <MenuItem Header="_Filters">
                <MenuItem Header="_Save Current Filter..." Command="{Binding SaveFilterCommand}"/>
                <MenuItem Header="_Load Filter..." Command="{Binding LoadFilterCommand}"/>
                <MenuItem Header="_Delete Filter..." Command="{Binding DeleteFilterCommand}"/>
                <Separator/>
                <MenuItem Header="_Export Filters..." Command="{Binding ExportFiltersCommand}"/>
                <MenuItem Header="_Import Filters..." Command="{Binding ImportFiltersCommand}"/>
            </MenuItem>
            <MenuItem Header="_View">
                <MenuItem Header="_Refresh" Command="{Binding ClearFiltersCommand}"/>
            </MenuItem>
        </Menu>

        <!-- Toolbar -->
        <ToolBar Grid.Row="1" ToolBarTray.IsLocked="True">
            <Button Command="{Binding OpenFileCommand}" ToolTip="Open Log File">
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="📂" FontSize="16" Margin="0,0,5,0"/>
                    <TextBlock Text="Open"/>
                </StackPanel>
            </Button>
           
            <Separator/>

            <TextBlock Text="Search:" VerticalAlignment="Center" Margin="5,0"/>
            <TextBox Width="200" 
                     Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}" 
                     VerticalAlignment="Center" 
                     Margin="5,0"
                     x:Name="SearchBox"/>
            <Button Command="{Binding SearchCommand}" Content="🔍 Search" Margin="5,0"/>
            <Button Command="{Binding FindPreviousCommand}" 
                    Content="⬆️" 
                    ToolTip="Previous Result (Shift+F3)"
                    Width="30"
                    Margin="2,0"
                    IsEnabled="{Binding TotalSearchResults, Converter={StaticResource GreaterThanZeroConverter}}"/>
            <Button Command="{Binding FindNextCommand}" 
                    Content="⬇️" 
                    ToolTip="Next Result (F3)"
                    Width="30"
                    Margin="2,0"
                    IsEnabled="{Binding TotalSearchResults, Converter={StaticResource GreaterThanZeroConverter}}"/>
            <TextBlock VerticalAlignment="Center" 
                       Margin="5,0"
                       Visibility="{Binding TotalSearchResults, Converter={StaticResource GreaterThanZeroConverter}}">
                <Run Text="{Binding CurrentSearchResultIndex, Converter={StaticResource PlusOneConverter}, Mode=OneWay}"/>
                <Run Text="/"/>
                <Run Text="{Binding TotalSearchResults, Mode=OneWay}"/>
            </TextBlock>
            <Separator/>

            <TextBlock Text="Level:" VerticalAlignment="Center" Margin="5,0"/>
            <ComboBox Width="100" 
                      ItemsSource="{Binding AvailableLogLevels}"
                      SelectedItem="{Binding SelectedLogLevelOption, Mode=TwoWay}"
                      DisplayMemberPath="DisplayName"
                      VerticalAlignment="Center" Margin="5,0"/>

            <Button Command="{Binding ApplyFilterCommand}" Content="Apply Filter" Margin="5,0"/>
            <Button Command="{Binding ClearFiltersCommand}" Content="Clear Filters" Margin="5,0"/>
            <Separator/>

            <TextBlock Text="Saved Filters:" VerticalAlignment="Center" Margin="5,0"/>
            <ComboBox Width="150" 
                      ItemsSource="{Binding SavedFilters}"
                      SelectedItem="{Binding SelectedFilter}"
                      DisplayMemberPath="Name"
                      VerticalAlignment="Center" Margin="5,0"/>
            <Button Command="{Binding LoadFilterCommand}" Content="Load" Margin="5,0"/>
        </ToolBar>

        <!-- AvalonEdit Log Viewer -->
        <avalon:TextEditor Grid.Row="2"
                           x:Name="LogEditor"
                           FontFamily="Consolas"
                           FontSize="12"
                           IsReadOnly="True"
                           ShowLineNumbers="True"
                           WordWrap="False"
                           HorizontalScrollBarVisibility="Auto"
                           VerticalScrollBarVisibility="Auto"
                           Margin="5">
            <avalon:TextEditor.ContextMenu>
                <ContextMenu>
                    <MenuItem Header="Copy" 
                              Command="{Binding CopyToClipboardCommand}"
                              InputGestureText="Ctrl+C">
                        <MenuItem.Icon>
                            <TextBlock Text="📋" FontSize="14"/>
                        </MenuItem.Icon>
                    </MenuItem>
                    <MenuItem Header="Copy to Search" 
                              Command="{Binding CopyToSearchCommand}">
                        <MenuItem.Icon>
                            <TextBlock Text="🔍" FontSize="14"/>
                        </MenuItem.Icon>
                    </MenuItem>
                    <Separator/>
                    <MenuItem Header="Select Whole Line" 
                              Command="{Binding SelectWholeLineCommand}"
                              InputGestureText="Ctrl+L">
                        <MenuItem.Icon>
                            <TextBlock Text="📄" FontSize="14"/>
                        </MenuItem.Icon>
                    </MenuItem>
                    <MenuItem Header="Select All" 
                              Command="{Binding SelectAllCommand}"
                              InputGestureText="Ctrl+A">
                        <MenuItem.Icon>
                            <TextBlock Text="📑" FontSize="14"/>
                        </MenuItem.Icon>
                    </MenuItem>
                </ContextMenu>
            </avalon:TextEditor.ContextMenu>
            <avalon:TextEditor.Options>
                <avalon:TextEditorOptions ShowSpaces="False"
                                          ShowTabs="False"
                                          ShowEndOfLine="False"
                                          ShowBoxForControlCharacters="False"
                                          EnableHyperlinks="True"
                                          EnableEmailHyperlinks="True"/>
            </avalon:TextEditor.Options>
        </avalon:TextEditor>

        <GridSplitter Grid.Row="3" Height="5" HorizontalAlignment="Stretch" Background="LightGray"/>

        <!-- Progress Bar (Visible when loading) -->
        <Grid Grid.Row="3" Background="White" Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibilityConverter}}">
            <StackPanel Margin="10" HorizontalAlignment="Center" VerticalAlignment="Center">
                <TextBlock Text="{Binding ProgressText}" 
                           FontWeight="SemiBold" 
                           HorizontalAlignment="Center" 
                           Margin="0,0,0,10"
                           Visibility="{Binding ProgressText, Converter={StaticResource NullToVisibilityConverter}}"/>
                <ProgressBar Width="400" 
                             Height="20" 
                             Value="{Binding ProgressPercentage}" 
                             Minimum="0" 
                             Maximum="100"
                             IsIndeterminate="{Binding ProgressPercentage, Converter={StaticResource IsZeroConverter}}"/>
                <TextBlock Text="{Binding ProgressPercentage, StringFormat='{}{0}% Complete'}" 
                           HorizontalAlignment="Center" 
                           Margin="0,5,0,0"
                           FontSize="12"
                           Foreground="Gray"/>
            </StackPanel>
        </Grid>

        <!-- Details Panel -->
        <GroupBox Grid.Row="4" Header="Log Entry Details" Margin="5">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <StackPanel Margin="5" DataContext="{Binding SelectedLogEntry}">
                    <TextBlock Text="{Binding Message}" FontWeight="Bold" TextWrapping="Wrap" Margin="0,0,0,10"/>
                    <TextBlock Text="{Binding Exception}" Foreground="Red" TextWrapping="Wrap" 
                               Visibility="{Binding Exception, Converter={StaticResource NullToVisibilityConverter}}"/>
                    <StackPanel Orientation="Horizontal" Margin="0,5,0,0">
                        <TextBlock Text="Timestamp: " FontWeight="Bold"/>
                        <TextBlock Text="{Binding Timestamp, StringFormat='yyyy-MM-dd HH:mm:ss.fff'}"/>
                        <TextBlock Text=" | Level: " FontWeight="Bold" Margin="20,0,0,0"/>
                        <TextBlock Text="{Binding Level}"/>
                        <TextBlock Text=" | Line: " FontWeight="Bold" Margin="20,0,0,0"/>
                        <TextBlock Text="{Binding LineNumber}"/>
                    </StackPanel>
                </StackPanel>
            </ScrollViewer>
        </GroupBox>

        <!-- Status Bar -->
        <StatusBar Grid.Row="5">
            <StatusBarItem>
                <TextBlock Text="{Binding StatusText}"/>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem>
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="Total: "/>
                    <TextBlock Text="{Binding TotalLogCount, StringFormat='{}{0:N0} entries'}"/>
                </StackPanel>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem>
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="Displayed: "/>
                    <TextBlock Text="{Binding LogEntries.Count, StringFormat='{}{0:N0}'}"/>
                </StackPanel>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem>
                <TextBlock Text="{Binding LoadedFilesInfo}"/>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</Window>
